{% extends "base.html" %} {% block content %}

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Coins Price</title>
  </head>
  <body>
    <p id="main"></p>

    <script type="text/javascript">
      //if window.location.protocol == https >wss  if not >ws
      const wss_protocol =
        window.location.protocol == "https:" ? "wss://" : "ws://";

      //  >wss://window.location.host/ws/socket-server
      const coinSocket = new WebSocket(
        wss_protocol + window.location.host + "/ws/price"
      );

      //'type': 'connection_established',
      //'message': 'Connected!'
      coinSocket.onmessage = function (e) {
        var data = JSON.parse(e.data);
        var coin_list = data["LIST"];
        var coin_data = data["DICT"];

        var listLength = coin_list.length;
        //for (var i = 0; i < listLength; i++) {
        //  	data_by_django = document.getElementById("price_" + i); //select the  element
        //	data_by_django.textContent =
        //  coin_list[i] + " : " + coin_data[coin_list[i]];
        //}
        var coin_price = document.getElementById("main");
        for (var i = 0; i < listLength; i++) {
          coin_price.innerHTML += "<h3>" + coin_list[i] + " : " + coin_data[coin_list[i]] + "</h3>";
        }
      };
    </script>
  </body>
</html>
{% endblock %}
